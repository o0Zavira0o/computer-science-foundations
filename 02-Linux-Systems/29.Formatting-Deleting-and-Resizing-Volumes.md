# Mastering LVM: Formatting, Deleting, and Resizing Volumes

## Introduction
Once you have created Logical Volumes (LVs), they act just like physical hard drive partitions. To use them, you must:
1.  **Format** them with a filesystem (like ext4).
2.  **Mount** them to a directory.

The true power of LVM, however, lies in its flexibility. If you realize you made a volume too small, or you have an old volume you don't need, you can delete and resize them **while the system is running**.

In this guide, we will walk through the lifecycle of a Logical Volume: **Create $\rightarrow$ Format $\rightarrow$ Delete (unused ones) $\rightarrow$ Resize (grow).**

---

## Part 1: Using the Logical Volume (Formatting)

After running `lvcreate`, you have a "raw" block device. You cannot save files to it yet. You must apply a filesystem.

**The Path:**
LVM creates user-friendly shortcuts for your devices. You can use either:
*   `/dev/mapper/VolumeGroup-LogicalVolume`
*   `/dev/VolumeGroup/LogicalVolume`

**The Command:**
$$ \texttt{mkfs -t ext4 [Path to LV]} $$

---

## Part 2: Removing a Logical Volume

If a volume is no longer needed, you can delete it to reclaim space.

**The Command:**
$$ \texttt{lvremove VolumeGroup/LogicalVolume} $$

### **CRITICAL WARNING: SYNTAX MATTERS**
When typing the removal command, you should use a **slash** (`/`) between the Group name and Volume name.

*   **Safe:** `lvremove myvg/myvol` (Deletes only `myvol`).
*   **Dangerous:** `lvremove myvg myvol` (Deletes `myvol` **AND** tries to delete the entire `myvg` group).

Always check the prompt before typing `y`!

---

## Part 3: Resizing Volumes (The Manual Way)

Resizing involves two distinct layers:
1.  **The Container (LVM):** You must make the logical partition bigger.
2.  **The Contents (Filesystem):** You must stretch the ext4 filesystem to fill the new container.

If you do this manually, you run two commands:
1.  `lvresize -l +[Extents] [Path]`: Extends the LVM boundary.
2.  `resize2fs [Path]` (or `fsadm`): Stretches the filesystem to fit.

---

## Part 4: Resizing Volumes (The Easy Way)

Modern LVM tools allow you to do both steps in a single command using the `-r` (resize filesystem) flag. You can also use percentage logic like `+100%FREE` to use up all remaining space.

**The Magic Command:**
$$ \texttt{lvresize -r -l +100\%FREE [Path]} $$

---

## Part 5: Hands-on Lab (GitHub Codespaces)

In this lab, we will simulate a full workflow. We will create a "disk," split it into two volumes, format them, delete one, and expand the other to take over the free space.

**Note:** Run these commands as `root` (use `sudo`).

### Step 1: Setup the Environment
We create a 300MB virtual disk, a Volume Group (`lab_vg`), and two volumes (`vol_1` and `vol_2`).

```bash
# 1. Create a 300MB file
dd if=/dev/zero of=lvm_practice.img bs=1M count=300

# 2. Attach loop device
LOOPDEV=$(sudo losetup -fP --show lvm_practice.img)

# 3. Create PV and VG
sudo pvcreate $LOOPDEV
sudo vgcreate lab_vg $LOOPDEV

# 4. Create two volumes (50MB each)
sudo lvcreate -L 50M -n vol_1 lab_vg
sudo lvcreate -L 50M -n vol_2 lab_vg

# 5. Check status
sudo lvs
```

### Step 2: Format and Mount `vol_1`
We will put a filesystem on `vol_1` and mount it so we can see the size.

```bash
# 1. Format with ext4
sudo mkfs -t ext4 /dev/lab_vg/vol_1

# 2. Create mount point
mkdir mnt_point

# 3. Mount it
sudo mount /dev/lab_vg/vol_1 mnt_point

# 4. Check the size
df -h mnt_point
```
**Observation:** usage should be around **45-50MB**.

### Step 3: Remove `vol_2`
We decided we don't need `vol_2`. Let's delete it.

```bash
# Syntax: lvremove Group/Volume
sudo lvremove lab_vg/vol_2
```
*Type `y` if asked to confirm.*

### Step 4: Resize `vol_1` (The Manual Method)
We will add 20MB to `vol_1` manually.
*Note: We are resizing while the disk is still mounted! This is called "Online Resizing."*

```bash
# 1. Extend the LVM container by 20MB
sudo lvresize -L +20M /dev/lab_vg/vol_1

# 2. Check disk space (df)
df -h mnt_point
```
**Observation:** Wait! The size in `df` didn't change?
**Reason:** We made the container bigger, but the filesystem inside is still small.

```bash
# 3. Resize the filesystem to fill the container
sudo resize2fs /dev/lab_vg/vol_1

# 4. Check disk space again
df -h mnt_point
```
**Observation:** Now the size has increased (approx 70MB).

### Step 5: Resize `vol_1` (The Easy Method)
Now we want `vol_1` to take up **all** the remaining space in the Volume Group (including the space freed by deleting `vol_2`). We will use the `-r` flag to handle the filesystem automatically.

```bash
# -r : Resize filesystem automatically
# -l +100%FREE : Add 100% of the remaining free space
sudo lvresize -r -l +100%FREE /dev/lab_vg/vol_1
```

### Step 6: Verify Final Result
```bash
# Check the mount point size
df -h mnt_point

# Check LVM details
sudo lvs
```
**Observation:** `vol_1` should now be nearly **300MB** (the full size of our virtual disk).

### Step 7: Clean Up
Always clean up your lab.

```bash
# 1. Unmount
sudo umount mnt_point

# 2. Remove LVs and Group
sudo lvremove -y lab_vg/vol_1
sudo vgremove lab_vg
sudo pvremove $LOOPDEV

# 3. Detach and delete file
sudo losetup -d $LOOPDEV
rm lvm_practice.img
rmdir mnt_point
```