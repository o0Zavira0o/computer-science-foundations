# MBR Limitations, System IDs, and LVM

In the previous section, we learned about MBR and GPT. While GPT is the modern standard, MBR is still everywhere. However, MBR has a major design flaw: it was built in the 1980s when nobody imagined a hard drive needing more than four sections.

This section explains how Linux gets around that limit using **Logical Partitions** and how to spot advanced storage systems like **LVM** (Logical Volume Manager).

---

## 1. The MBR Problem: The "Pizza Slice" Limit
The Master Boot Record (MBR) table has a hard limit: **It can only hold 4 entries.**
If you want to divide your disk into 6 parts (e.g., Boot, System, Data, Games, Backup, Swap), MBR physically cannot list them all.

### The Solution: Extended & Logical Partitions
To solve this, we use a trick called the **Extended Partition**.
1.  **Primary Partitions (1‚Äì4):** Standard partitions. You can have up to 4.
2.  **Extended Partition:** A special container. It takes up one "Primary" slot but acts like a wrapper.
3.  **Logical Partitions (5+):** Inside the Extended Partition, you can create as many sub-partitions as you want.

$$ \text{MBR Slot 1} \to \text{Primary (Win)} \\ \text{MBR Slot 2} \to \text{Primary (Linux)} \\ \text{MBR Slot 3} \to \text{Primary (Data)} \\ \text{MBR Slot 4} \to \underbrace{\textbf{Extended Container}}_{\text{Holds Logical 5, 6, 7...}} $$

*Note: In Linux, Primary partitions are numbered 1-4. Logical partitions always start at number 5.*

## 2. System IDs (The Hex Codes)
How does the computer know that Partition 1 is a "Linux Swap" area and Partition 2 is a "Windows" drive?
It uses a **System ID** (a Hexadecimal number).

*   **`83`**: Linux Filesystem (The standard).
*   **`82`**: Linux Swap (Virtual RAM).
*   **`8e`**: Linux LVM (Logical Volume Manager).
*   **`07`**: Windows NTFS.

**Crucial Difference:**
*   **`fdisk`:** Shows the raw **ID number** (e.g., `83`). It is the most accurate source of truth.
*   **`parted`:** Looks at the **Flag** or the filesystem content. It tries to be user-friendly ("ext4", "linux-swap").

## 3. Spotting LVM (Logical Volume Manager)
LVM is a layer of software that glues multiple hard drives together into one big "Volume Group."
When running `parted -l`, you can tell a system uses LVM if:
1.  **Flags:** You see the flag `lvm` on a physical partition.
2.  **Device Names:** You see paths like `/dev/mapper/ubuntu--vg-root` or `/dev/dm-0`.
3.  **Type:** The partition type code is `8e`.

---

# üõ†Ô∏è Hands-On Lab: GitHub Codespaces

We are going to push the limits of MBR. We will create a virtual drive, hit the 4-partition limit, use an Extended partition to break through it, and then assign different System IDs (Swap and LVM) to see how tools report them.

### Step 1: Create a MBR Disk
Create a blank 200MB file and attach it.

```bash
# Create file
dd if=/dev/zero of=mbr_test.img bs=1M count=200

# Attach to loop device
DISK=$(sudo losetup -fP --show mbr_test.img)

# Label it as MBR (msdos)
sudo parted $DISK mklabel msdos
```

### Step 2: Fill the Primary Slots (The Limit)
We will use `fdisk` to create partitions because it handles the Extended logic very clearly.

```bash
sudo fdisk $DISK
```
*(Follow these keystrokes exactly inside the interactive menu):*

1.  **`n`** (New partition) $\to$ **`p`** (Primary) $\to$ **`1`** $\to$ **`[Enter]`** $\to$ **`+10M`** (Partition 1)
2.  **`n`** (New partition) $\to$ **`p`** (Primary) $\to$ **`2`** $\to$ **`[Enter]`** $\to$ **`+10M`** (Partition 2)
3.  **`n`** (New partition) $\to$ **`p`** (Primary) $\to$ **`3`** $\to$ **`[Enter]`** $\to$ **`+10M`** (Partition 3)

*At this point, we have used 3 of the 4 slots.*

### Step 3: Create the Extended Container
Now we create the 4th partition, but we make it **Extended** so we can fit more inside.

4.  **`n`** (New partition)
5.  **`e`** (Select **Extended** instead of Primary)
6.  **`[Enter]`** (Default number 4)
7.  **`[Enter]`** (Start default)
8.  **`[Enter]`** (Use all remaining space)

*Now we have a container. Let's create Logical partitions inside it.*

9.  **`n`** (New) $\to$ **`[Enter]`** (Default starts at 5) $\to$ **`+10M`**
10. **`n`** (New) $\to$ **`[Enter]`** (Default starts at 6) $\to$ **`+10M`**

### Step 4: Change System IDs (Simulate Swap and LVM)
Let's mark Partition 1 as "Swap" and Partition 6 as "LVM".

11. **`t`** (Change type) $\to$ **`1`** (Partition 1) $\to$ **`82`** (Code for Swap)
12. **`t`** (Change type) $\to$ **`6`** (Partition 6) $\to$ **`8e`** (Code for LVM)
13. **`p`** (Print table to verify)
14. **`w`** (Write and Exit)

### Step 5: Compare `fdisk` vs `parted`
Now, let's look at how the two tools report our work.

**View 1: `fdisk` (The Raw Truth)**
```bash
sudo fdisk -l $DISK
```
**Observation:**
*   Look at the **Id** column. You will clearly see `82`, `83`, `5` (Extended), and `8e`.
*   Look at the **Device** names. Notice how it jumps from `p4` to `p5`.

**View 2: `parted` (The User Friendly View)**
```bash
sudo parted $DISK print
```
**Observation:**
*   `parted` doesn't show the Hex IDs (`82`, `8e`).
*   Instead, look at the **Type** column. It explicitly says `primary`, `extended`, and `logical`.
*   Look at the **Flags** column. Partition 6 should have the `lvm` flag.

### Step 6: Cleanup
```bash
sudo losetup -D
rm mbr_test.img
```